---
layout: default
id: manifest
title: Plugins
heading: Plugins
---

Plugins are a key feature of bootstrap-vz.
Despite their small size (most plugins do not exceed 100 source lines of code)
they can modify the behavior of bootstrapped systems to a great extent.<br/>
Below you will find documentation for all plugins available for bootstrap-vz.
If you cannot find what you are looking for, consider <a href="development.html">developing it yourself</a>
and contribute to this list!


<p>
	<h2 id="admin_user">Admin user</h2>
	This plugin creates a user with passwordless sudo privileges.
	It also disables the SSH root login.
	If the EC2 init scripts are installed, the script for fetching the
	SSH authorized keys will be adjust to match the username specified.
</p>
<h3>Settings</h3>
<p>
	<ul>
		<li>
			<tt>username</tt>: The username of the account to create.
			<span class="required label label-danger"></span>
		</li>
	</ul>
</p>


<p>
	<h2 id="apt_proxy">APT Proxy</h2>
	This plugin creates a proxy configuration file for APT, so you could enjoy the benefits of using cached packages
	instead of downloading them from the mirror every time.
	You could just install <tt>apt-cacher-ng</tt> on the host machine and then add <tt>"address": "127.0.0.1"</tt> and
	<tt>"port": 3142</tt> to the manifest file.
</p>
<p>
	<h3>Settings</h3>
	<ul>
		<li>
			<tt>address</tt>: The IP or host of the proxy server.
			<span class="required label label-danger"></span>
		</li>
		<li>
			<tt>port</tt>: The port (integer) of the proxy server.
			<span class="required label label-danger"></span>
		</li>
		<li>
			<tt>persistent</tt>: Whether the proxy configuration file should remain on the machine or not.
			<span class="valid-enum label label-primary">true, false</span>
			<span class="default label label-default">false</span>
			<span class="optional label label-success"></span>
		</li>
	</ul>
</p>

<p>
	<h2 id="cloud_init">cloud-init</h2>
	This plugin installs and configures <a href="https://packages.debian.org/wheezy-backports/cloud-init">cloud-init</a>
	on the system. Depending on the release it installs it from either backports or the main repository.<br/>
	cloud-init is only compatible with Debian wheezy and upwards.
</p>
<p>
	<h3>Settings</h3>
	<ul>
		<li>
			<tt>username</tt>: The username of the account to create.
			<span class="required label label-danger"></span>
		</li>
		<li>
			<tt>disable_modules</tt>: A list of strings specifying which cloud-init modules should be disabled.
			<span class="optional label label-success"></span>
		</li>
		<li>
			<tt>metadata_sources</tt>: A string that sets the
			<a href="http://cloudinit.readthedocs.org/en/latest/topics/datasources.html">datasources</a> that cloud-init
			should try fetching metadata from.
			The source is automatically set when using the ec2 provider.
			<span class="optional label label-success"></span>
		</li>
	</ul>
</p>

<p>
	<h2 id="image_commands">Image commands</h2>
	The image commands plugin allows you to run arbitrary commands during the bootstrap process.
	The commands are run at an indeterminate point <i>after</i> packages have been installed, but
	<i>before</i> the volume has been unmounted.
</p>
<p>
	<h3>Settings</h3>
	<ul>
		<li>
			<tt>commands</tt>: A list of lists containing strings. Each top-level item is a single command,
			while the strings inside each list comprise parts of a command. This allows for proper shell argument
			escaping (to circumvent this, simply put the entire command in a single string).
			In addition to the manifest variables <tt>{root}</tt> is also available.
			It points at the root of the image volume.
			<span class="required label label-danger"></span>
			<span class="manifest_vars label label-info"></span>
		</li>
	</ul>
</p>

<p>
	<h2 id="minimize_size">minimize size</h2>
	This plugin can be used to reduce the size of the resulting image.
	Often virtual volumes are much smaller than their reported size until any data is written to them.
	During the bootstrapping process temporary data like the aptitude cache is written to the volume
	only to be removed again.<br/>
	The minimize size plugin employs three different strategies to keep a low volume footprint:
	<ul>
		<li>
			Mount folders from the host into key locations of the image volume to avoid any unneccesary disk writes.
		</li>
		<li>
			Use <a href="http://intgat.tigress.co.uk/rmy/uml/index.html">zerofree</a> to deallocate unused sectors
			on the volume.
			On an unpartitioned volume this will be done for the entire volume, while it will only happen on
			the root partition for partitioned volumes.
		</li>
		<li>
			Use <a href="https://www.vmware.com/support/ws45/doc/disks_vdiskmanager_eg_ws.html">vmware-vdiskmanager</a>
			to shrink the real volume size (only applicable when using vmdk backing).
			The tool is part of the <a href="https://my.vmware.com/web/vmware/info/slug/desktop_end_user_computing/vmware_workstation/10_0">VMWare Workstation</a> package.
		</li>
	</ul>
</p>
<p>
	<h3>Settings</h3>
	<ul>
		<li>
			<tt>zerofree</tt>: Specifies if it should mark unallocated blocks as zeroes, so the volume could be better shrunk after this. 
			<span class="valid-enum label label-primary">true, false</span>
			<span class="default label label-default">false</span>
			<span class="optional label label-success"></span>
		</li>
		<li>
			<tt>shrink</tt>: Whether the volume should be shrunk. This setting works best in conjunction with the
			zerofree tool.
			<span class="valid-enum label label-primary">true, false</span>
			<span class="default label label-default">false</span>
			<span class="optional label label-success"></span>
		</li>
	</ul>
</p>

<p>
	<h2 id="ntp">NTP</h2>
	This plugins installs the Network Time Protocol daemon and optionally defines which time servers it should use.
</p>
<p>
	<h3>Settings</h3>
	<ul>
		<li>
			<tt>servers</tt>: A list of strings specifying which servers should be used to synchronize the machine clock.
			<span class="optional label label-success"></span>
		</li>
	</ul>
</p>

<p>
	<h2 id="opennebula">Open Nebula</h2>
	This plugin adds <a href="http://opennebula.org/documentation:rel4.2:cong">OpenNebula contextualization</a>
	to the image, which sets up the network configuration and SSH keys.<br/>
	The virtual machine context should be configured as follows:
<pre>
ETH0_DNS      $NETWORK[DNS, NETWORK_ID=2]
ETH0_GATEWAY  $NETWORK[GATEWAY, NETWORK_ID=2]
ETH0_IP       $NIC[IP, NETWORK_ID=2]
ETH0_MASK     $NETWORK[MASK, NETWORK_ID=2]
ETH0_NETWORK  $NETWORK[NETWORK, NETWORK_ID=2]
FILES         path_to_my_ssh_public_key.pub
</pre>
	The plugin will install all *.pub* files in the root authorized_keys file.
	When using the ec2 provider, the USER_EC2_DATA will be executed if present.
</p>
<p>
	<h3>Settings</h3>
	This plugin has no settings. To enable it add <tt>"opennebula":{}</tt> to the plugin section of the manifest.
</p>

<p>
	<h2 id="prebootstrapped">prebootstrapped</h2>
	When developing for bootstrap-vz, testing can be quite tedious since the bootstrapping process can take while.
	The prebootstrapped plugin solves that problem by creating a snapshot of your volume right after all the
	software has been installed. The next time bootstrap-vz is run, the plugin replaces
	all volume preparation and bootstrapping tasks and recreates the volume from the snapshot instead.<br/>
	The plugin assumes that the users knows what he is doing and e.g. doesn't check whether bootstrap-vz is
	being run with a partitioned volume configuration, while the snapshot is unpartitioned.<br/>
	When no snapshot or image is specified the plugin creates on and outputs its ID/path.
	Specifying an ID/path automatically enables the second mode of operation which recreates the volume from
	the specified snapshot instead of creating it from scratch.
</p>
<p>
	<h3>Settings</h3>
	<ul>
		<li>
			<tt>snapshot</tt>: ID of the EBS snapshot to use.
			This setting only works with EBS backed EC2 configurations.
		</li>
		<li>
			<tt>image</tt>: Path to the loopbackvolume snapshot.
			This setting works with all configurable volume backings except EBS.
		</li>
	</ul>
</p>

<p>
	<h2 id="puppet">Puppet</h2>
	Installs <a href="http://puppetlabs.com/">puppet</a> and optionally applies a manifest inside the chroot.
	You can also have it copy your puppet configuration into the image so it is readily available
	once the image is booted.<br/>
	Keep in mind that when applying a manifest, the system is in a chrooted environment.
	This can prevent daemons from running properly (e.g. listening to ports), they will also
	need to be shut down gracefully (which bootstrap-vz cannot do) before unmounting the volume.
	It is advisable to avoid starting any daemons inside the chroot at all.
</p>
<p>
	<h3>Settings</h3>
	<ul>
		<li>
			<tt>manifest</tt>: Path to the puppet manifest that should be applied.
			<span class="optional label label-success"></span>
		</li>
		<li>
			<tt>assets</tt>: Path to puppet assets. The contents will be copied into <tt>/etc/puppet</tt>
			on the image. Any existing files will be overwritten.
			<span class="optional label label-success"></span>
		</li>
		<li>
			<tt>enable_agent</tt>: Whether the puppet agent daemon should be enabled.
			<span class="optional label label-success"></span>
		</li>
	</ul>
</p>

<p>
	<h2 id="root_password">root password</h2>
	Sets the root password. This plugin removes the task that disables the SSH password authentication.
</p>
<p>
	<h3>Settings</h3>
	<ul>
		<li>
			<tt>password</tt>: The password for the root user.
			<span class="required label label-danger"></span>
		</li>
	</ul>
</p>

<p>
	<h2 id="unattended_upgrades">Unattended upgrades</h2>
	Enables the <a href="https://packages.debian.org/wheezy/unattended-upgrades">unattended update/upgrade feature</a>
	in aptitude. Enable it to have your system automatically download and install security updates automatically
	with a set interval.
</p>
<p>
	<h3>Settings</h3>
	<ul>
		<li>
			<tt>update_interval</tt>: Days between running <tt>apt-get update</tt>.
			<span class="required label label-danger"></span>
		</li>
		<li>
			<tt>download_interval</tt>: Days between running <tt>apt-get upgrade --download-only</tt>
			<span class="required label label-danger"></span>
		</li>
		<li>
			<tt>upgrade_interval</tt>: Days between installing any security upgrades.
			<span class="required label label-danger"></span>
		</li>
	</ul>
</p>

<p>
	<h2 id="vagrant">Vagrant</h2>
	Vagrant is a tool to quickly create virtualized environments. It uses "boxes" to make downloading and
	sharing those environments easier. A box is a tarball containing a virtual volumes accompanied by an
	<a href="http://en.wikipedia.org/wiki/Open_Virtualization_Format">OVF specification</a> of the virtual
	machine.<br/>
	This plugin creates a vagrant box that is ready to be shared or deployed. At the moment it is only
	compatible with the VirtualBox provider and doesn't requires any additional settings.
</p>

<p>
	<h2 id="salt">Salt</h2>
	Install <a href="http://www.saltstack.com/">salt</a> minion in
	the image. Uses
	<a href="https://github.com/saltstack/salt-bootstrap">salt-bootstrap</a>
	script to install.
</p>
<p>
	<h3>Settings</h3>
	<ul>
		<li>
			<tt>install_source</tt>: Source to install salt codebase from. 
			<span class="valid label label-primary"> <tt>stable</tt> for current stable,
			<tt>daily</tt> for installing the daily build, and <tt>git</tt> to install from git repository.
			<span class="required label label-danger"></span>
		</li>
		<li>
			<tt>version</tt>: Only needed if you are installing from <tt>git</tt>.
			<span class="valid label label-primary"><tt>develop</tt> to install current development head, 
			or provide any tag name or commit hash from <a href="https://github.com/saltstack/salt">salt repo</a>
			<span class="optional label label-success"></span>
		</li>
		<li>
			<tt>master</tt>: Salt master FQDN or IP
			<span class="optional label label-success"></span>
		</li>
		<li>
		        <tt>grains</tt>: Set <a href="http://docs.saltstack.com/en/latest/topics/targeting/grains.html">
			salt grains</a> for this minion. Accepts a map with grain name as key and the grain data as value.
			<span class="optional label label-success"></span>
		</li>

	</ul>
</p>
